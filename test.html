<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>魔力值计算器</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 8px 12px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .btn-reset {
      background-color: #f44336;
    }

    .btn-save {
      background-color: #2196F3;
    }

    .btn-random {
      background-color: #ff9800;
    }

    h2 {
      margin: 0 0 10px 0;
      color: #333;
    }

    .rule-note {
      color: #666;
      font-size: 14px;
      margin-bottom: 15px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 4px;
    }

    .filter-container {
      margin-bottom: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }

    .filter-label {
      margin-right: 5px;
      align-self: center;
    }

    .filter-btn {
      padding: 4px 8px;
      background-color: #f0f0f0;
      color: #333;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      white-space: nowrap;
    }

    .filter-btn.active {
      background-color: #2196F3;
      color: white;
      border-color: #2196F3;
    }

    .pet-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin: 20px 0;
      max-height: 500px;
      overflow-y: auto;
    }

    .pet-card {
      background: #fff;
      border: 2px solid #eee;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .pet-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .pet-card.selected {
      border-color: #2196F3;
      background: #e6f7ff;
    }

    .pet-card.disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    .pet-img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin: 0 auto 10px;
      display: block;
    }

    .pet-name {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding: 0 5px;
    }

    .pet-value {
      font-size: 12px;
      color: #666;
      background: #f0f0f0;
      display: inline-block;
      padding: 2px 8px;
      border-radius: 10px;
    }

    .selected-pets {
      margin: 20px 0;
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 6px;
    }

    .selected-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .selected-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      max-height: 500px;
      overflow-y: auto;
    }

    .selected-item {
      background: #e6f7ff;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      flex-direction: column;
    }

    .selected-item img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      margin-bottom: 5px;
    }

    .remove-btn {
      margin-left: 8px;
      color: #f5222d;
      cursor: pointer;
      font-weight: bold;
    }

    .error {
      color: #cf1322;
      margin: 10px 0;
      font-size: 14px;
      display: none;
    }

    .result {
      margin: 15px 0;
      font-weight: bold;
      font-size: 16px;
      color: #1890ff;
    }

    .history {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }

    .history h3 {
      margin: 0 0 15px;
      color: #333;
    }

    .history-item {
      margin-bottom: 15px;
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 6px;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      align-items: center;
    }

    .history-round {
      font-weight: bold;
    }

    .history-actions {
      display: flex;
      gap: 10px;
    }

    .history-pets {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .history-pet {
      background: #f0f0f0;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 13px;
      display: flex;
      align-items: center;
    }

    .history-pet img {
      width: 20px;
      height: 20px;
      object-fit: contain;
      margin-right: 5px;
    }

    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
      display: none;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #2196F3;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .search-container {
      margin-bottom: 15px;
    }

    .search-input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 200px;
    }

    .toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #333;
      color: white;
      padding: 10px 20px;
      border-radius: 4px;
      font-size: 16px;
      z-index: 1000;
    }

    /* 基础样式保持不变 */

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .container {
        padding: 10px;
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
      }

      .header-actions {
        margin-bottom: 10px;
      }

      .filter-container {
        flex-direction: column;
        align-items: flex-start;
      }

      .filter-label {
        margin-bottom: 5px;
      }

      .pet-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }

      .pet-card {
        padding: 5px;
      }

      .pet-img {
        width: 60px;
        height: 60px;
      }

      .selected-list {
        max-height: 300px;
      }

      .selected-item {
        padding: 5px 10px;
      }

      .selected-item img {
        width: 30px;
        height: 30px;
      }

      .history-item {
        padding: 10px;
      }

      .history-pet {
        padding: 3px 8px;
      }

      .history-pet img {
        width: 15px;
        height: 15px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="header-actions">
        <button class="btn btn-reset" onclick="resetCurrentSelection()">重置已选</button>
        <button class="btn btn-save" onclick="saveCurrentSelection()">保存本轮</button>
      </div>
      <h2>魔力值计算器</h2>
    </div>

    <div class="rule-note">
      魔力值玩法规则：魔力值总和不超过16，最多选择6个宠物
    </div>

    <div class="search-container">
      <input type="text" class="search-input" id="searchInput" placeholder="搜索宠物" oninput="searchPets()">
    </div>

    <div class="selected-pets">
      <div class="selected-title">已选宠物（最多6个）</div>
      <div class="result">
        魔力值总和：<span id="totalValue">0</span>
      </div>
      <div class="selected-list" id="selectedList">
        <span class="empty-text">暂无选择</span>
      </div>
    </div>

    <div class="filter-container">
      <span class="filter-label">按魔力值筛选：</span>
      <button class="filter-btn active" data-value="all">全部</button>
      <button class="filter-btn" data-value="5">5</button>
      <button class="filter-btn" data-value="4.5">4.5</button>
      <button class="filter-btn" data-value="4">4</button>
      <button class="filter-btn" data-value="3.5">3.5</button>
      <button class="filter-btn" data-value="3">3</button>
      <button class="filter-btn" data-value="2.5">2.5</button>
      <button class="filter-btn" data-value="2">2</button>
      <button class="filter-btn" data-value="1.5">1.5</button>
      <button class="filter-btn" data-value="1">1</button>
    </div>

    <div class="pet-grid" id="petGrid">
      <!-- 宠物卡片将通过JS动态生成 -->
    </div>
    <div class="history">
      <h3>历史记录</h3>
      <div id="historyContainer">
        <p>暂无记录</p>
      </div>
      <button class="btn btn-reset" onclick="clearAllHistory()">清空对局</button>
    </div>
  </div>

  <div class="loading" id="loading">
    <div class="loading-spinner"></div>
  </div>
  <script src="./config.js"></script>
  <script>
    let allSelectedPets = [];
    const petConfig = {
      "3": [
        "多角铃鹿", "暗毁灭伯爵", "赤炎飞龙 物攻", "格兰酋长", "超人鸭吉吉", "艾米", "骨龙", "萌之王者",
        "圣龙阿布", "利爪黑熊", "圣藤草王", "上古猛犸象", "立方人", "金刚紫贝", "少林呱呱", "罗卡德", "圣水守护",
        "九尾神狐", "超导缇塔", "不败雷瓦汀", "无敌胖胖猪", "肚兜面罩鼠", "糯米头领", "菲尼克斯", "狼烟之魂", "天鹅领主",
        "远古战神", "怪钉洛萨", "云雾仙子", "帕尔萨斯", "霹雳球", "盗圣黑萨姆", "船长马库斯", "八爪海皇", "巨魔狂鲨",
        "暗夜骑士", "惊涛波塞尔", "贝古斯", "王者奎托斯", "萝卜老翁", "霹雳旋风鼠", "巨岩先知"
      ],
      "3.5": [
        "火爆猴", "火云战马", "巴拉姆", "烈火战神", "超级瓦斯", "石化刺蜥蜴",
        "深渊黑迪斯", "大力神", "金宝宝", "月夜行者", "法老王", "奥德诺",
        "蓝衣夜灵", "圣羽翼王", "魔晶凤凰", "恶魔战士", "雷霆妙尔尼", '水晶鹿'
      ],
      "2.5": [
        "麋鹿", "遁鼠", "灵蔓草王", "冰晶古赤虎", "幽兰雪魅", "魔力猫", "骨龙恶魔", "云雾犬", "记忆石", "阿木木",
        "暮雪尾兽", "闪亮烟花", "诺姆", "红莲兽", "仙草菇灵", "银翼狮王", "不屈战魂", "巨牙猛犸象", "还愿蛇仙", "鹦鹉哨",
        "圣诞/鸭吉吉", "艾酥酥", "七彩圣灵", "梦中天使", "雷霆虎王", "人鱼守护者", "大神犬", "多灵主", "武空侠", "皇家圣光迪莫",
        "先锋君主", "赤炎守护", "嘟星彩熊", "岩浆犀牛", "玛雅石像鬼", "花叶龙", "卡秋莎", "神圣玄武", "猫老大", "圣光迪莫",
        "幽灵冰姬", "暴力猿", "小恶魔洛基", "幽冥战龙", "食梦者", "富贵呱呱", "乐罐罐"
      ],
      "1.5": [
        "星美", "白金独角兽", "黄金独角兽", "青铜独角兽", "鱼龙", "加尔", "金桑羊", "瓦斯叮当", "魔能小子", "梅花鹿", "白须菇菇", "蝎子王", "风暴战犬",
        "督察骑士", "鳄鱼警长", "冷月狼", "梦幻卡洛儿", "乐动仙女", "藤蔓蛋龙", "触灵飞龙", "水灵兽", "爵士鹿", "小皮球", "飞天翼豹", "巨石之父", "粉钻兔兔",
        "永夜战龙", "烟斗船长", "参天蓬蓬", "武斗宰相", "鲁特", "怒火兽", "仙音", "丰羽嘴龙", "痛苦电环", "霹雳领主", "灵魂守护", "烈火飞龙", "精灵多哥",
        "饮雪狂兽", "圣诞老人", "树人守护", "帝米亚", "伊兰亚龙", "林中鹤仙", "长弓射手", "巴斯特", "美鹅鹅", "念珠鹤", "绅士鸡", "岩凯领主", "炮塔瓢虫",
        "格兰球", "奇丽果", "美豆豆", "米花", "千年雪莲", "蔓藤兽", "绿衣小葵", "白发露露", "空灵斗士", "碧翎离朱", "石化木登", "动感小子", "小天使安琪",
        "草莓寄居蟹", "萤火仙子", "冰钻布鲁斯", "刺头哭眼鸭", "帕恩", "财神企鹅", "红桃雀后", "机械蛮牛", "瞌睡王", "霸道把总", "暴角龙", "火龙大亨", "幽冥之眼"
      ],
      "2": [
        "神圣青龙", "神圣人鱼", "巨翎天鹅", "绿萝魔灵", "串鱼巨蟹", "皇家狮鹫", "上古战龙", "水球球", "冰翼邪神", "雪影娃娃", "毁灭笔记", "黄蜂后",
        "雷神之子", "光芒使者", "龟仙人", "爆焰飞龙", "大头骨龙", "冰霜狼王", "黑炎", "万寿芝灵", "琉璃水母", "电子超人", "矿山金兽", "水晶巫师",
        "冥狐", "赤炎凯撒", "鬼魅羚羊", "幽冥紫灯", "天使圣诞鸟", "迪莫", "石敢当", "赤炎耀甲", "寒翼剑", "星耀帝", "幻影霸主", "炸弹头领",
        "魔瓜头领", "水晶巨人", "欢悦吉他", "酷拉", "火麒麟", "美妖狐", "布莱克岩", "逍遥呱呱", "紫霸龙", "蓝焰幽灵主", "彩蝶鲨", "凡鹰",
        "骷髅法师", "超能阿布", "魔爪圣灵", "米陶诺斯", "猪蜻蜓", "魔尾战猫", "科多索", "迷你利乌", "蒜头熊族长", "圣冠布鲁斯", "雪精灵", "幽蝠王子",
        "艾不败", "熊猫拳王", "圣诞鸭吉吉", "红萝卜兔", "海洋之神", "仲裁弗兰克", "幽游娃娃", "桃面鼠", "超能丘比特", "深海霸主", "烈火狂兽", "智慧帕特拉",
        "帝王雪狮", '昏睡纺锤'
      ],
      "5": ["火云神", "冰龙王", "图灵", "武斗酷猫 电磁猫", "雪顶妖兽", "赤炎飞龙", "英魂修罗"],
      "4.5": ["永恒冈尼尔", "傲雪冰灵", "喷火猿"],
      "1": ["其余宠物"],
      "4": [
        "武斗酷猫 无电磁", "雪顶妖兽 无遗传", "傲雪冰灵 无遗传", "喷火猿 无遗传", "钻石独角兽", "慈母鼠",
        "罗隐", "骄阳耀者", "双生维洛司", "战伐虎神", "鹿角贝贝", "蒸汽神龙",
        "暗黑大力神", "极电妖兽", "巨灵石", "白极圣王", "公测冰龙王", "冰翼晶灵", "天球"
      ]
    };

    // 整理所有宠物为统一格式（名称+魔力值+图片）
    const allPets = [];

    // 处理顶级魔力值分类
    for (const valueStr of ["3", "3.5", "2.5", "1.5", "2", "4", "5", "4.5", "1"]) {
      const value = parseFloat(valueStr);
      petConfig[valueStr].forEach(petName => {
        allPets.push({
          name: petName,
          value: value,
          // 使用随机图片占位（实际使用时替换为真实图片URL）
          img: /https/.test(obj[petName]) ? obj[petName] : 'https://newsimg.5054399.com/uploads/userup' + obj[petName]
        });
      });
    }

    const slbConfig = petConfig["魔力值玩法（魔力值总和不超16）"];
    // 构建宠物名称到魔力值的映射
    const petValueMap = {};
    allPets.forEach(pet => {
      petValueMap[pet.name] = {
        value: pet.value,
        img: pet.img
      };
    });

    // DOM元素
    const petGrid = document.getElementById('petGrid');
    const selectedList = document.getElementById('selectedList');
    const totalValue = document.getElementById('totalValue');
    const maxCountError = document.getElementById('maxCountError');
    const sumError = document.getElementById('sumError');
    const historyContainer = document.getElementById('historyContainer');
    const loading = document.getElementById('loading');
    const searchInput = document.getElementById('searchInput');

    // 状态变量
    let selectedPets = JSON.parse(localStorage.getItem('selectedPets')) || [];
    let history = JSON.parse(localStorage.getItem('selectionHistory')) || [];
    let total = selectedPets.reduce((sum, petName) => sum + (petValueMap[petName]?.value || 0), 0);
    let currentFilter = 'all';

    // 初始化
    renderPetGrid();
    renderSelectedPets();
    renderHistory();
    updateTotal();
    setupFilterButtons();
    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.remove();
      }, 1500);
    }

    // 渲染宠物网格
    function renderPetGrid() {
      petGrid.innerHTML = '';

      // 根据当前筛选条件过滤宠物
      const filteredPets = currentFilter === 'all'
        ? allPets
        : allPets.filter(pet => pet.value.toString() === currentFilter);

      if (filteredPets.length === 0) {
        petGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #666;">暂无符合条件的宠物</div>';
        return;
      }

      filteredPets.forEach(pet => {
        const isSelected = selectedPets.includes(pet.name);
        const card = document.createElement('div');
        card.className = `pet-card ${isSelected ? 'selected' : ''} ${isSelected ? 'disabled' : ''}`;
        card.innerHTML = `
                    <img src="${pet.img}" alt="${pet.name}" class="pet-img">
                    <div class="pet-name">${pet.name}</div>
                    <div class="pet-value">魔力值: ${pet.value}</div>
                `;
        card.addEventListener('click', () => togglePetSelection(pet.name));
        petGrid.appendChild(card);
      });
    }
    function renderPetGrid() {
      petGrid.innerHTML = '';

      // 根据当前筛选条件过滤宠物
      const filteredPets = currentFilter === 'all'
        ? allPets
        : allPets.filter(pet => pet.value.toString() === currentFilter);

      if (filteredPets.length === 0) {
        petGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #666;">暂无符合条件的宠物</div>';
        return;
      }

      filteredPets.forEach(pet => {
        const isSelected = selectedPets.includes(pet.name);
        const isDisabled = allSelectedPets.includes(pet.name);
        const card = document.createElement('div');
        card.className = `pet-card ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}`;
        card.innerHTML = `
                <img src="${pet.img}" alt="${pet.name}" class="pet-img">
                <div class="pet-name">${pet.name}</div>
                <div class="pet-value">魔力值: ${pet.value}</div>
            `;
        if (!isDisabled) {
          card.addEventListener('click', () => togglePetSelection(pet.name));
        }
        petGrid.appendChild(card);
      });
    }

    // 切换宠物选择状态
    function togglePetSelection(petName) {
      if (allSelectedPets.includes(petName)) {
        return;
      }
      const index = selectedPets.indexOf(petName);

      if (index > -1) {
        // 取消选择
        selectedPets.splice(index, 1);
        total -= petValueMap[petName].value;
      } else {
        // 限制最多6个
        if (selectedPets.length >= 6) {
          showToast('最多只能选择 6 个宠物！');
          return;
        }

        // 添加选择
        selectedPets.push(petName);
        total += petValueMap[petName].value;
      }

      // 检查总和是否超过16
      if (selectedPets.length === 6 && total > 16) {
        showToast('魔力值总和超过 16！');
        total -= petValueMap[petName].value;
        selectedPets.pop();
      }

      // 更新UI
      renderPetGrid();
      renderSelectedPets();
      updateTotal();
      saveToLocalStorage();
    }

    // 渲染已选宠物列表
    function renderSelectedPets() {
      selectedList.innerHTML = '';

      if (selectedPets.length === 0) {
        selectedList.innerHTML = '<span class="empty-text">暂无选择</span>';
        return;
      }

      selectedPets.forEach((petName, index) => {
        const item = document.createElement('div');
        item.className = 'selected-item';
        item.innerHTML = `
                    <img src="${petValueMap[petName]?.img}" alt="${petName}">
                    ${petName} (${petValueMap[petName]?.value})
                    <span class="remove-btn" onclick="removePet(${index})">×</span>
                `;
        selectedList.appendChild(item);
      });
    }

    // 移除已选宠物
    function removePet(index) {
      total -= petValueMap[selectedPets[index]].value;
      selectedPets.splice(index, 1);
      renderPetGrid();
      renderSelectedPets();
      updateTotal();
      saveToLocalStorage();
    }

    // 更新总和显示
    function updateTotal() {
      totalValue.textContent = total.toFixed(1);
    }

    // 重置当前选择
    function resetCurrentSelection() {
      selectedPets = [];
      total = 0;
      renderPetGrid();
      renderSelectedPets();
      updateTotal();
      saveToLocalStorage();
    }

    // 保存当前选择到历史
    function saveCurrentSelection() {
      if (selectedPets.length === 0) {
        showToast('请先选择宠物！');
        return;
      }

      if (selectedPets.length > 6) {
        showToast('最多只能选择6个宠物！');
        return;
      }

      if (total > 16) {
        showToast('魔力值总和不能超过16！');
        return;
      }

      // 添加到历史
      history.push({
        pets: [...selectedPets],
        total: total,
        time: new Date().toLocaleString()
      });
      allSelectedPets = history.flatMap(record => record.pets);
      // 保存到本地存储
      localStorage.setItem('selectionHistory', JSON.stringify(history));

      // 渲染历史记录
      renderHistory();

      // 重置当前选择
      resetCurrentSelection();

      showToast('已保存记录！');
    }

    // 渲染历史记录
    function renderHistory() {
      if (history.length === 0) {
        historyContainer.innerHTML = '<p>暂无记录</p>';
        return;
      }

      historyContainer.innerHTML = '';
      history.forEach((record, index) => {
        const div = document.createElement('div');
        div.className = 'history-item';

        const header = document.createElement('div');
        header.className = 'history-header';
        header.innerHTML = `
                    <div class="history-round">第 ${index + 1} 轮（${record.time}）</div>
                    <div class="history-actions">
                        <span>总和: ${record.total.toFixed(1)}</span>
                        <button class="btn btn-reset" onclick="removeHistory(${index})">删除</button>
                    </div>
                `;

        const petsDiv = document.createElement('div');
        petsDiv.className = 'history-pets';

        record.pets.forEach((petName, petIndex) => {
          const petSpan = document.createElement('div');
          petSpan.className = 'history-pet';
          petSpan.innerHTML = `
                        <img src="${petValueMap[petName].img}" alt="${petName}">
                        ${petName} (${petValueMap[petName]?.value || 0})
                        <span class="remove-btn" onclick="removePetFromHistory(${index}, ${petIndex})">×</span>
                    `;
          petsDiv.appendChild(petSpan);
        });

        div.appendChild(header);
        div.appendChild(petsDiv);
        historyContainer.appendChild(div);
      });
    }

    // 删除历史记录
    function removeHistory(index) {
      history.splice(index, 1);
      localStorage.setItem('selectionHistory', JSON.stringify(history));
      renderHistory();
    }

    // 从历史记录中删除单个宠物
    function removePetFromHistory(historyIndex, petIndex) {
      const record = history[historyIndex];
      const petName = record.pets[petIndex];
      record.total -= petValueMap[petName].value;
      record.pets.splice(petIndex, 1);

      if (record.pets.length === 0) {
        history.splice(historyIndex, 1);
      }

      localStorage.setItem('selectionHistory', JSON.stringify(history));
      renderHistory();
    }

    // 清空所有历史记录
    function clearAllHistory() {
      if (confirm('确定要清空所有历史记录吗？')) {
        history = [];
        localStorage.setItem('selectionHistory', JSON.stringify(history));
        renderHistory();
      }
    }

    // 设置筛选按钮
    function setupFilterButtons() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      filterButtons.forEach(btn => {
        btn.addEventListener('click', function () {
          const value = this.getAttribute('data-value');
          currentFilter = value;

          // 更新按钮样式
          filterButtons.forEach(b => b.classList.remove('active'));
          this.classList.add('active');

          // 重新渲染宠物网格
          renderPetGrid();
        });
      });
    }

    // 保存到本地存储
    function saveToLocalStorage() {
      localStorage.setItem('selectedPets', JSON.stringify(selectedPets));
    }

    // 搜索宠物
    function searchPets() {
      const searchTerm = searchInput.value.trim().toLowerCase();
      if (searchTerm === '') {
        currentFilter = 'all';
        setupFilterButtons();
        renderPetGrid();
        return;
      }

      const foundPet = allPets.find(pet => pet.name.toLowerCase().includes(searchTerm));
      if (foundPet) {
        currentFilter = 'all'; // 清除当前筛选条件
        setupFilterButtons();
        renderPetGrid();

        const petCard = Array.from(petGrid.children).find(card => card.querySelector('.pet-name').textContent === foundPet.name);
        if (petCard) {
          petCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }
    }

  </script>
</body>

</html>